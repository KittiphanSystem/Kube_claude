# Auto-generated by blueprintctl
---
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: tenant-demo-tenant
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "5"
    kube-saas/tenant: "demo-tenant"
    kube-saas/plan: "starter"
spec:
  description: "Tenant demo-tenant â€” locked to own namespace + repo"
  sourceRepos:
    - https://github.com/org/demo-apps.git
  destinations:
    - namespace: tenant-demo-tenant
      server: https://kubernetes.default.svc
  clusterResourceWhitelist: []
  namespaceResourceWhitelist:
    - group: "apps"
      kind: Deployment
    - group: "apps"
      kind: StatefulSet
    - group: "apps"
      kind: ReplicaSet
    - group: ""
      kind: Service
    - group: ""
      kind: ConfigMap
    - group: ""
      kind: Secret
    - group: ""
      kind: ServiceAccount
    - group: ""
      kind: PersistentVolumeClaim
    - group: "networking.k8s.io"
      kind: Ingress
    - group: "autoscaling"
      kind: HorizontalPodAutoscaler
    - group: "batch"
      kind: Job
    - group: "batch"
      kind: CronJob
  roles:
    - name: viewer
      description: "Tenant demo-tenant read-only"
      policies:
        - p, proj:tenant-demo-tenant:viewer, applications, get, tenant-demo-tenant/*, allow
      groups:
        - tenant-demo-tenant-viewers
    - name: deployer
      description: "Tenant demo-tenant can sync"
      policies:
        - p, proj:tenant-demo-tenant:deployer, applications, sync, tenant-demo-tenant/*, allow
        - p, proj:tenant-demo-tenant:deployer, applications, get, tenant-demo-tenant/*, allow
        - p, proj:tenant-demo-tenant:deployer, applications, action/*, tenant-demo-tenant/*, allow
      groups:
        - tenant-demo-tenant-deployers
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: tenant-demo-tenant-apps
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "10"
    kube-saas/tenant: "demo-tenant"
spec:
  project: tenant-demo-tenant
  source:
    repoURL: https://github.com/org/demo-apps.git
    targetRevision: main
    path: environments/prod
  destination:
    server: https://kubernetes.default.svc
    namespace: tenant-demo-tenant
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=false
      - PrunePropagationPolicy=foreground
    retry:
      limit: 5
      backoff:
        duration: 5s
        factor: 2
        maxDuration: 3m
  ignoreDifferences:
    - group: apps
      kind: Deployment
      jsonPointers:
        - /spec/replicas
